<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adlai Dyson Photo Map</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-search@2.9.7/dist/leaflet-search.min.css"/>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  <script src="https://unpkg.com/leaflet-search@2.9.7/dist/leaflet-search.min.js"></script>

  <script>
    // Initialize map and base layers
    const osmLayer = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: '&copy; OpenStreetMap contributors'
    });

    // Mapbox Satellite Streets layer (satellite imagery with road labels)
    const satelliteLayer = L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiYWR5c29uZmZwIiwiYSI6ImNtYWIyYmx5aTI1dWwyaXNndnMxY2djMzkifQ.76GkXTqg6P-FsnJKiPe-Sg", {
      attribution: '&copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      tileSize: 512,
      zoomOffset: -1
    });

    // Initialize map with default view
    const map = L.map("map", { layers: [osmLayer] }).setView([53.47, -1.37], 11);

    // Add Layer Control for Switching Between Layers
    const baseMaps = {
      "Normal": osmLayer,
      "Satellite": satelliteLayer
    };
    L.control.layers(baseMaps).addTo(map);

    // Add Search Control with Autocomplete (for better results)
    const geocoder = L.Control.geocoder({
      collapsed: false,
      placeholder: "Search for places",
      errorMessage: "Could not find location",
      showResultIcons: true,
      position: "topright"
    }).addTo(map);

    // Load locations from JSON and add markers
    fetch("locations.json")
      .then((res) => res.json())
      .then((locations) => {
        const markers = new L.LayerGroup(); // To group all markers

        locations.forEach((loc) => {
          const marker = L.marker([loc.lat, loc.lng])
            .addTo(markers)
            .bindPopup(`<b>${loc.name}</b><br><a href="${loc.url}" target="_blank">View photos</a>`);

          marker.locName = loc.name; // for search
        });

        // Add markers to map and search control
        markers.addTo(map);
        const searchControl = new L.Control.Search({
          layer: markers,
          propertyName: "locName",
          zoom: 14, // Zoom level on search result
          initial: false,
          marker: false,
          textErr: 'Location not found!',
          autoCollapse: true,
          hideMarkerOnCollapse: false
        }).on('search:locationfound', function(e) {
          // Explicitly zoom to the location after a search result
          map.setView(e.latlng, 14);  // Set the zoom and center to the found location
        });
        map.addControl(searchControl);
      })
      .catch((err) => {
        console.error("Error loading locations.json:", err);
      });
  </script>
</body>
</html
